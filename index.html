<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./static/css/style.css">
    <title title>Calculadora Lógica</title>
  </head>
  <body>
    <div id="app">
      <div id="calc">
        <div class="caixa_text">
            <textarea name="visor" id="visor" cols="30" ></textarea>
        </div>
        <div id="btn_container">
          <button class="btn btn_diferente" onclick="limpar()">AC</button>
          <button class="btn btn_diferente" onclick="back()">C</button>
          <button class="btn btn_diferente" onclick="back()">&#9003;</button>
          <button class="btn btn_diferente" onclick="insert('&#40;')">&#40;</button>
          <button class="btn btn_diferente" onclick="insert('&#41;')">&#41;</button>
          
          <button class="btn" onclick="insert('A')">A</button>
          <button class="btn" onclick="insert('B')">B</button>
          <button class="btn" onclick="insert('C')">C</button>
          <button class="btn" onclick="insert('D')">D</button>
          <button class="btn btn_diferente" onclick="insert('∧')">∧</button>
    
          <button class="btn" onclick="insert('E')">E</button>
          <button class="btn" onclick="insert('F')">F</button>
          <button class="btn" onclick="insert('G')">G</button>
          <button class="btn" onclick="insert('H')">H</button>
          <button class="btn btn_diferente" onclick="insert('∨')">∨</button>
    
          <button class="btn" onclick="insert('I')">I</button>
          <button class="btn" onclick="insert('J')">J</button>
          <button class="btn" onclick="insert('K')">K</button>
          <button class="btn" onclick="insert('L')">L</button>
          <button class="btn btn_diferente" onclick="insert('→')">→</button>
    
          <button class="btn" onclick="insert('M')">M</button>
          <button class="btn" onclick="insert('N')">N</button>
          <button class="btn" onclick="insert('O')">O</button>
          <button class="btn" onclick="insert('P')">P</button>
          <button class="btn btn_diferente" onclick="insert('¬')">¬</button>
    
          <button class="btn" onclick="insert('Q')">Q</button>
          <button class="btn" onclick="insert('R')">R</button>
          <button class="btn" onclick="insert('S')">S</button>
          <button class="btn" onclick="insert('T')">T</button>
          <button class="btn btn_diferente" onclick="insert('↔')">↔</button>
    
          <button class="btn" onclick="insert('U')">U</button>
          <button class="btn" onclick="insert('V')">V</button>
          <button class="btn" onclick="insert('W')">W</button>
          <button class="btn" onclick="insert('X')">X</button>
          <button class="btn" onclick="insert('Y')">Y</button>
    
          <button class="btn" id="ultima_letra" onclick="insert('Z')">Z</button>
          <button class="btn btn_diferente" id="igual" onclick="resultado()">=</button>
            
        </div>
      </div>
      <div class="label-container"></div>
      <table id="tableContainer"></table>
    </div>
    <script type="module"> 
              import { mountTruthTable } from 'logical-expressions-solver';

        function insert(text){
          var texto = document.getElementById('visor').innerHTML 
          document.getElementById('visor').innerHTML = texto + text
        }
        function limpar(limpa){
          document.getElementById('visor').innerHTML = ""
          document.getElementById('tableContainer').innerHTML = ""
          document.querySelector('.label-container p').remove()
        }
        function back(){
          var texto = document.getElementById('visor').innerHTML 
          document.getElementById('visor').innerHTML = texto.substring(0, texto.length - 1)
          console.log(texto.substring(0, texto.length - 1))
        }
        function resultado() {
          const tableContainer = document.getElementById('tableContainer');
          const labelContainer = document.querySelector('.label-container');
          const label = document.querySelector('.label-container p')
          const resultTable = tableContainer.querySelector('table');

          let truthTable = mountTruthTable(document.getElementById('visor').innerHTML);

          const resultColumn = truthTable.map((row) => Object.values(row).at(-1));
          if (label) label.remove(); 
          labelContainer.appendChild(createLabel(resultColumn))
          
          if (resultTable) resultTable.remove();
          tableContainer.appendChild(createTable(truthTable));
        }

        function createLabel(resultColumn) {
          const label = document.createElement('p');

          if (resultColumn.every((item) => item == true)) label.innerText = 'É uma tautologia!'
          else if (resultColumn.some((item) => item == true)) label.innerText = 'É uma contingência!'
          else label.innerText = 'É uma contradição!';

          return label;
        }

        function createTable(data) {
          var table = document.createElement('table');
          var thead = document.createElement('thead');
          var tbody = document.createElement('tbody');

          var headRow = document.createElement('tr');
          Object.keys(data[0]).forEach(function(key) {
            var th = document.createElement('th');
            th.textContent = key;
            headRow.appendChild(th);
          });
          thead.appendChild(headRow);
          table.appendChild(thead);

          data.forEach(function(rowData) {
            var row = document.createElement('tr');
            Object.values(rowData).forEach(function(value) {
              var cell = document.createElement('td');
              cell.textContent = value ? 'V' : 'F';
              row.appendChild(cell);
            });
            tbody.appendChild(row);
          });

          table.appendChild(tbody);
          return table;
        }


        window.insert = insert;
        window.limpar = limpar;
        window.back = back;
        window.resultado = resultado;


    </script>
  </body>
</html>
